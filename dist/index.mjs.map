{"version":3,"sources":["../src/icon.ts","../src/bitte-wallet.ts","../src/bitte-wallet-setup.ts"],"names":["icon","DEFAULT_POPUP_WIDTH","DEFAULT_POPUP_HEIGHT","POLL_INTERVAL","getInitialState","saveState","state","createWalletConfig","walletUrl","network","providers","getAccountId","getPublicKey","KeyPair","isSignedIn","signOut","newState","requestSignInUrl","config","contractId","methodNames","currentUrl","newUrl","functionCallKey","accessKey","methodName","requestSignIn","url","handlePopupTransaction","data","responseData","publicKey","accountId","updatedState","signMessage","message","nonce","recipient","callbackUrl","messageState","href","value","storedKeyCanSign","receiverId","actions","signUsingKeyPair","myKeyStore","keyStores","keyPair","connect","a","createAction","requestSignTransactionsUrl","txs","stringifiedParam","_","v","urlParam","signAndSendTransactionsPopUp","txsHashes","hash","signAndSendTransaction","error","signAndSendTransactions","transactionsWS","setupMessageHandler","resolve","reject","childWindow","callback","event","origin","walletBaseUrl","screenWidth","screenHeight","left","top","messageHandler","intervalId","createBitteWalletConnector","params","result","transactions","resolveWalletUrl","setupWalletState","BitteWallet","metadata","options","store","logger","getAccounts","sgnState","signerId","contract","signedAccountId","setupBitteWallet","iconUrl","deprecated","moduleOptions"],"mappings":"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","file":"index.mjs","sourcesContent":["export const icon = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTUiIGhlaWdodD0iOTUiIHZpZXdCb3g9IjAgMCA5NSA5NSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xLjc3NjE3IDU5LjE4MjZMNjIuNzIyNyA2My4zMTNDNjMuMTE4NSA2My40MzA5IDYzLjQ3ODggNjMuNjQ1NiA2My43NzA4IDYzLjkzNzdDNjQuMDYyOSA2NC4yMjk3IDY0LjI3NzUgNjQuNTg5OSA2NC4zOTU0IDY0Ljk4NThMNjguNTI1OSA3OC44NTU1QzY4LjY3ODcgNzkuMzY4NiA2OC45OTMyIDc5LjgxODYgNjkuNDIyNCA4MC4xMzg3QzY5Ljg1MTYgODAuNDU4NyA3MC4zNzI3IDgwLjYzMTYgNzAuOTA4MiA4MC42MzE2QzcxLjQ0MzYgODAuNjMxNiA3MS45NjQ3IDgwLjQ1ODcgNzIuMzkzOSA4MC4xMzg3QzcyLjgyMzEgNzkuODE4NiA3My4xMzc2IDc5LjM2ODYgNzMuMjkwNCA3OC44NTU1TDc3LjQyMDkgNjQuOTg1OEM3Ny41Mzg4IDY0LjU4OTkgNzcuNzUzNCA2NC4yMjk3IDc4LjA0NTUgNjMuOTM3N0M3OC4zMzc2IDYzLjY0NTYgNzguNjk3OCA2My40MzA5IDc5LjA5MzYgNjMuMzEzTDkyLjk2MzMgNTkuMTgyNkM5My40NzY0IDU5LjAyOTcgOTMuOTI2NSA1OC43MTUzIDk0LjI0NjYgNTguMjg2MUM5NC41NjY2IDU3Ljg1NjggOTQuNzM5NSA1Ny4zMzU3IDk0LjczOTUgNTYuODAwM0M5NC43Mzk1IDU2LjI2NDkgOTQuNTY2NiA1NS43NDM4IDk0LjI0NjYgNTUuMzE0NkM5My45MjY1IDU0Ljg4NTMgOTMuNDc2NCA1NC41NzA5IDkyLjk2MzMgNTQuNDE4MUw3OS4wOTM3IDUwLjI4NzZDNzguNjk3OCA1MC4xNjk3IDc4LjMzNzYgNDkuOTU1IDc4LjA0NTUgNDkuNjYzQzc3Ljc1MzUgNDkuMzcwOSA3Ny41Mzg4IDQ5LjAxMDcgNzcuNDIwOSA0OC42MTQ4TDczLjI5MDQgMzQuNzQ1MkM3My4xMzc2IDM0LjIzMiA3Mi44MjMyIDMzLjc4MTkgNzIuMzkzOSAzMy40NjE5QzcxLjk2NDcgMzMuMTQxOSA3MS40NDM2IDMyLjk2OSA3MC45MDgyIDMyLjk2OUM3MC4zNzI4IDMyLjk2OSA2OS44NTE3IDMzLjE0MTkgNjkuNDIyNCAzMy40NjE5QzY4Ljk5MzIgMzMuNzgxOSA2OC42Nzg4IDM0LjIzMiA2OC41MjYgMzQuNzQ1Mkw2NC4zOTU0IDQ4LjYxNDhDNjQuMjc3NiA0OS4wMTA3IDY0LjA2MjkgNDkuMzcwOSA2My43NzA4IDQ5LjY2M0M2My40Nzg4IDQ5Ljk1NSA2My4xMTg1IDUwLjE2OTcgNjIuNzIyNyA1MC4yODc2TDEuNzc2MTggNTQuNDE4MUMxLjI2MzA1IDU0LjU3MDkgMC44MTI5NTYgNTQuODg1MyAwLjQ5MjkyIDU1LjMxNDZDMC4xNzI4ODQgNTUuNzQzOCAyLjI0NzU1ZS0wNiA1Ni4yNjQ5IDAgNTYuODAwM0MtMi4yNDc1MWUtMDYgNTcuMzM1NyAwLjE3Mjg4NyA1Ny44NTY4IDAuNDkyOTIgNTguMjg2MUMwLjgxMjk1MyA1OC43MTUzIDEuMjYzMDMgNTkuMDI5NyAxLjc3NjE3IDU5LjE4MjZaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMyLjE2MzcgMjkuNDg2OEw0MC4zNTc4IDMxLjkyNzFDNDAuNTkxNyAzMS45OTY3IDQwLjgwNDUgMzIuMTIzNiA0MC45NzcgMzIuMjk2MUM0MS4xNDk2IDMyLjQ2ODcgNDEuMjc2NCAzMi42ODE1IDQxLjM0NjEgMzIuOTE1NEw0My43ODYzIDQxLjEwOTVDNDMuODc2NiA0MS40MTI2IDQ0LjA2MjQgNDEuNjc4NSA0NC4zMTYgNDEuODY3NkM0NC41Njk2IDQyLjA1NjcgNDQuODc3NCA0Mi4xNTg4IDQ1LjE5MzcgNDIuMTU4OEM0NS41MTAxIDQyLjE1ODggNDUuODE3OSA0Mi4wNTY3IDQ2LjA3MTUgNDEuODY3NkM0Ni4zMjUxIDQxLjY3ODUgNDYuNTEwOSA0MS40MTI2IDQ2LjYwMTEgNDEuMTA5NUw0OS4wNDE0IDMyLjkxNTRDNDkuMTExMSAzMi42ODE1IDQ5LjIzNzkgMzIuNDY4NyA0OS40MTA0IDMyLjI5NjFDNDkuNTgzIDMyLjEyMzYgNDkuNzk1OCAzMS45OTY3IDUwLjAyOTcgMzEuOTI3MUw1OC4yMjM4IDI5LjQ4NjhDNTguNTI2OSAyOS4zOTY2IDU4Ljc5MjggMjkuMjEwOCA1OC45ODE5IDI4Ljk1NzJDNTkuMTcxIDI4LjcwMzYgNTkuMjczMSAyOC4zOTU4IDU5LjI3MzEgMjguMDc5NEM1OS4yNzMxIDI3Ljc2MzEgNTkuMTcxIDI3LjQ1NTMgNTguOTgxOSAyNy4yMDE3QzU4Ljc5MjggMjYuOTQ4MSA1OC41MjY5IDI2Ljc2MjMgNTguMjIzOCAyNi42NzJMNTAuMDI5NiAyNC4yMzE3QzQ5Ljc5NTggMjQuMTYyMSA0OS41ODI5IDI0LjAzNTIgNDkuNDEwNCAyMy44NjI3QzQ5LjIzNzkgMjMuNjkwMiA0OS4xMTEgMjMuNDc3MyA0OS4wNDE0IDIzLjI0MzRMNDYuNjAxMSAxNS4wNDkzQzQ2LjUxMDggMTQuNzQ2MiA0Ni4zMjUgMTQuNDgwMyA0Ni4wNzE1IDE0LjI5MTJDNDUuODE3OSAxNC4xMDIxIDQ1LjUxIDE0IDQ1LjE5MzcgMTRDNDQuODc3NCAxNCA0NC41Njk1IDE0LjEwMjEgNDQuMzE1OSAxNC4yOTEyQzQ0LjA2MjMgMTQuNDgwMyA0My44NzY2IDE0Ljc0NjIgNDMuNzg2MyAxNS4wNDkzTDQxLjM0NiAyMy4yNDM0QzQxLjI3NjQgMjMuNDc3MyA0MS4xNDk1IDIzLjY5MDIgNDAuOTc3IDIzLjg2MjdDNDAuODA0NCAyNC4wMzUyIDQwLjU5MTYgMjQuMTYyMSA0MC4zNTc4IDI0LjIzMTdMMzIuMTYzNyAyNi42NzJDMzEuODYwNSAyNi43NjIyIDMxLjU5NDYgMjYuOTQ4IDMxLjQwNTUgMjcuMjAxNkMzMS4yMTY0IDI3LjQ1NTIgMzEuMTE0MyAyNy43NjMxIDMxLjExNDMgMjguMDc5NEMzMS4xMTQzIDI4LjM5NTggMzEuMjE2NCAyOC43MDM3IDMxLjQwNTUgMjguOTU3MkMzMS41OTQ2IDI5LjIxMDggMzEuODYwNSAyOS4zOTY2IDMyLjE2MzcgMjkuNDg2OFoiIGZpbGw9ImJsYWNrIi8+Cjwvc3ZnPgo=';\n","import type {\n  Action,\n  FinalExecutionOutcome,\n  Network,\n  SignMessageParams,\n  Transaction,\n} from \"@near-wallet-selector/core\";\nimport { createAction } from \"@near-wallet-selector/wallet-utils\";\nimport { connect, keyStores, providers } from \"near-api-js\";\nimport type { PublicKey } from \"near-api-js/lib/utils/index.js\";\nimport { KeyPair } from \"near-api-js/lib/utils/index.js\";\nimport { WalletConfig, WalletMessage, WalletResponseData, WalletState } from \"./types\";\n\n\n// Constants\nconst DEFAULT_POPUP_WIDTH = 480;\nconst DEFAULT_POPUP_HEIGHT = 640;\nconst POLL_INTERVAL = 300;\n\n\n// State management\nconst getInitialState = (): WalletState => ({\n  signedAccountId: localStorage.getItem(\"bitte:signedAccountId\") || \"\",\n  functionCallKey: JSON.parse(localStorage.getItem(\"bitte:functionCallKey\") || \"null\"),\n});\n\nconst saveState = (state: WalletState): void => {\n  localStorage.setItem(\"bitte:signedAccountId\", state.signedAccountId);\n  localStorage.setItem(\"bitte:functionCallKey\", JSON.stringify(state.functionCallKey));\n};\n\n// Create wallet configuration\nconst createWalletConfig = (walletUrl: string, network: Network): WalletConfig => ({\n  walletUrl,\n  network,\n  provider: new providers.JsonRpcProvider({ url: network.nodeUrl }),\n});\n\n// Core functions\nconst getAccountId = (state: WalletState): string => {\n  return state.signedAccountId;\n};\n\nconst getPublicKey = (state: WalletState): PublicKey | undefined => {\n  if (state.functionCallKey) {\n    return KeyPair.fromString(state.functionCallKey.privateKey as any).getPublicKey();\n  }\n  return undefined;\n};\n\nconst isSignedIn = (state: WalletState): boolean => {\n  return !!state.signedAccountId;\n};\n\nconst signOut = (): WalletState => {\n  const newState = {\n    signedAccountId: \"\",\n    functionCallKey: null,\n  };\n  saveState(newState);\n  return newState;\n};\n\nconst requestSignInUrl = (\n  config: WalletConfig,\n  { contractId, methodNames }: { contractId: string; methodNames?: Array<string> }\n): { url: string; newState: WalletState } => {\n  const currentUrl = new URL(window.location.href);\n  const newUrl = new URL(`${config.walletUrl}/login/`);\n\n  newUrl.searchParams.set(\"success_url\", currentUrl.href);\n  newUrl.searchParams.set(\"failure_url\", currentUrl.href);\n\n  let functionCallKey = null;\n\n  if (contractId) {\n    newUrl.searchParams.set(\"contract_id\", contractId);\n\n    const accessKey = KeyPair.fromRandom(\"ed25519\");\n    newUrl.searchParams.set(\n      \"public_key\",\n      accessKey.getPublicKey().toString()\n    );\n\n    functionCallKey = {\n      privateKey: accessKey.toString(),\n      contractId,\n      methods: methodNames || [],\n    };\n  }\n\n  if (methodNames) {\n    methodNames.forEach((methodName) => {\n      newUrl.searchParams.append(\"methodNames\", methodName);\n    });\n  }\n\n  const newState = getInitialState();\n  newState.functionCallKey = functionCallKey;\n  saveState(newState);\n\n  return { url: newUrl.toString(), newState };\n};\n\nconst requestSignIn = async (\n  config: WalletConfig,\n  state: WalletState,\n  { contractId, methodNames }: { contractId: string; methodNames?: Array<string> }\n): Promise<Array<{ accountId: string; publicKey: string }>> => {\n  const { url, newState } = requestSignInUrl(config, { contractId, methodNames });\n\n  return handlePopupTransaction(config, url, async (data) => {\n    const responseData = data as WalletResponseData;\n    const { public_key: publicKey, account_id: accountId } = responseData;\n\n    if (accountId) {\n      const updatedState = { ...newState, signedAccountId: accountId };\n      saveState(updatedState);\n      return [{ accountId, publicKey: publicKey || \"\" }];\n    }\n    throw new Error(\"Invalid response data from wallet\");\n  });\n};\n\nconst signMessage = async (\n  config: WalletConfig,\n  { message, nonce, recipient, callbackUrl, state: messageState }: SignMessageParams\n) => {\n  const url = callbackUrl || window.location.href;\n\n  if (!url) {\n    throw new Error(`BitteWallet: CallbackUrl is missing`);\n  }\n\n  const href = new URL(config.walletUrl);\n  href.pathname = \"sign-message\";\n  href.searchParams.append(\"message\", message);\n  href.searchParams.append(\"nonce\", nonce.toString(\"base64\"));\n  href.searchParams.append(\"recipient\", recipient);\n  href.searchParams.append(\"callbackUrl\", url);\n\n  if (messageState) {\n    href.searchParams.append(\"state\", messageState);\n  }\n\n  return handlePopupTransaction(config, href.toString(), (value) => {\n    return {\n      accountId: value?.signedRequest?.accountId || \"\",\n      publicKey: value?.signedRequest?.publicKey || \"\",\n      signature: value?.signedRequest?.signature || \"\",\n    };\n  });\n};\n\nconst storedKeyCanSign = (\n  state: WalletState,\n  receiverId: string,\n  actions: Array<Action>\n): boolean => {\n  if (\n    state.functionCallKey &&\n    state.functionCallKey.contractId === receiverId\n  ) {\n    return (\n      actions[0].type === \"FunctionCall\" &&\n      actions[0].params.deposit === \"0\" &&\n      (state.functionCallKey.methods.length === 0 ||\n        state.functionCallKey.methods.includes(actions[0].params.methodName))\n    );\n  }\n  return false;\n};\n\nconst signUsingKeyPair = async (\n  config: WalletConfig,\n  state: WalletState,\n  { receiverId, actions }: { receiverId: string; actions: Array<Action> }\n): Promise<FinalExecutionOutcome> => {\n  // instantiate an account (NEAR API is a nightmare)\n  const myKeyStore = new keyStores.InMemoryKeyStore();\n  const keyPair = KeyPair.fromString(state.functionCallKey!.privateKey as any);\n\n  await myKeyStore.setKey(\n    config.network.networkId,\n    state.signedAccountId,\n    keyPair\n  );\n\n  const near = await connect({ ...config.network, keyStore: myKeyStore });\n  const account = await near.account(state.signedAccountId);\n\n  return account.signAndSendTransaction({\n    receiverId,\n    actions: actions.map((a) => createAction(a)),\n  });\n};\n\nconst requestSignTransactionsUrl = (\n  config: WalletConfig,\n  txs: Array<Transaction>\n): string => {\n  const newUrl = new URL(`${config.walletUrl}/sign-transaction`);\n  const stringifiedParam = JSON.stringify(txs, (_, v) => typeof v === 'bigint' ? v.toString() : v);\n  const urlParam = encodeURIComponent(stringifiedParam);\n\n  newUrl.searchParams.set('transactions_data', urlParam);\n  newUrl.searchParams.set('callback_url', window.location.origin);\n\n  return newUrl.toString();\n};\n\nconst signAndSendTransactionsPopUp = async (\n  config: WalletConfig,\n  txs: Array<Transaction>\n): Promise<Array<FinalExecutionOutcome>> => {\n  const url = requestSignTransactionsUrl(config, txs);\n  const txsHashes = (\n    await handlePopupTransaction(config, url, (data) => data.transactionHashes)\n  )?.split(\"%2C\");\n\n  if (!txsHashes) {\n    throw new Error(\"No transaction hashes received\");\n  }\n  return Promise.all(\n    txsHashes.map((hash) => config.provider.txStatus(hash, \"unused\"))\n  );\n};\n\n\n\nconst signAndSendTransaction = async (\n  config: WalletConfig,\n  state: WalletState,\n  { receiverId, actions }: { receiverId: string; actions: Array<Action> }\n): Promise<FinalExecutionOutcome> => {\n  if (actions.length === 1 && storedKeyCanSign(state, receiverId, actions)) {\n    try {\n      return await signUsingKeyPair(config, state, { receiverId, actions });\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        \"Failed to sign using key pair, falling back to wallet\",\n        error\n      );\n    }\n  }\n\n  const results = await signAndSendTransactionsPopUp(config, [{ signerId: state.signedAccountId, receiverId, actions }]);\n  return results[0];\n};\n\nconst signAndSendTransactions = async (\n  config: WalletConfig,\n  state: WalletState,\n  transactionsWS: Array<Transaction>\n): Promise<Array<FinalExecutionOutcome>> => {\n\n  return signAndSendTransactionsPopUp(config, transactionsWS);\n};\n\n// Helper functions\nconst setupMessageHandler = <T>(\n  config: WalletConfig,\n  resolve: (value: T) => void,\n  reject: (reason?: unknown) => void,\n  childWindow: Window | null,\n  callback: (result: WalletMessage) => T\n): (event: MessageEvent) => Promise<void> => {\n  const handler = async (event: MessageEvent) => {\n    const message = event.data as WalletMessage;\n\n    // check if the URL are the same\n    const origin = new URL(event.origin);\n    const walletBaseUrl = new URL(config.walletUrl);\n\n    if (origin.origin !== walletBaseUrl.origin) {\n      // eslint-disable-next-line no-console\n      console.warn(\"Ignoring message from different origin\", origin.origin);\n      return;\n    }\n\n    switch (message.status) {\n      case \"success\":\n        childWindow?.close();\n        resolve(callback(message));\n        break;\n      case \"failure\":\n        childWindow?.close();\n        reject(new Error(message.errorMessage || \"Transaction failed\"));\n        break;\n      default:\n        // eslint-disable-next-line no-console\n        console.warn(\"Unhandled message status:\", message.status);\n    }\n  };\n\n  return handler;\n};\n\nconst handlePopupTransaction = <T>(\n  config: WalletConfig,\n  url: string,\n  callback: (result: WalletMessage) => T\n): Promise<T> => {\n  const screenWidth = window.innerWidth || screen.width;\n  const screenHeight = window.innerHeight || screen.height;\n  const left = (screenWidth - DEFAULT_POPUP_WIDTH) / 2;\n  const top = (screenHeight - DEFAULT_POPUP_HEIGHT) / 2;\n\n  const childWindow = window.open(\n    url,\n    \"BitteWallet\",\n    `width=${DEFAULT_POPUP_WIDTH},height=${DEFAULT_POPUP_HEIGHT},top=${top},left=${left}`\n  );\n\n  if (!childWindow) {\n    throw new Error(\n      \"Popup window blocked. Please allow popups for this site.\"\n    );\n  }\n\n  return new Promise<T>((resolve, reject) => {\n    const messageHandler = setupMessageHandler(\n      config,\n      resolve,\n      reject,\n      childWindow,\n      callback\n    );\n\n    window.addEventListener(\"message\", messageHandler);\n\n    const intervalId = setInterval(() => {\n      if (childWindow.closed) {\n        window.removeEventListener(\"message\", messageHandler);\n        clearInterval(intervalId);\n        reject(new Error(\"User closed the window\"));\n      }\n    }, POLL_INTERVAL);\n  });\n};\n\n\nexport const createBitteWalletConnector = (walletUrl: string, network: Network) => {\n  const config = createWalletConfig(walletUrl, network);\n  let state = getInitialState();\n\n  return {\n    getAccountId: () => getAccountId(state),\n    getPublicKey: () => getPublicKey(state),\n    isSignedIn: () => isSignedIn(state),\n    signOut: () => {\n      state = signOut();\n      return null;\n    },\n    requestSignIn: async (params: { contractId: string; methodNames?: Array<string> }) => {\n      const result = await requestSignIn(config, state, params);\n      // Update state after sign-in\n      state = getInitialState();\n      return result;\n    },\n    requestSignInUrl: (params: { contractId: string; methodNames?: Array<string> }) => {\n      const { url, newState } = requestSignInUrl(config, params);\n      state = newState;\n      return url;\n    },\n    signMessage: (params: SignMessageParams) => signMessage(config, params),\n    signAndSendTransaction: (params: { receiverId: string; actions: Array<Action> }) =>\n      signAndSendTransaction(config, state, params),\n    signAndSendTransactions: (transactions: Array<Transaction>) =>\n      signAndSendTransactions(config, state, transactions),\n  };\n};","import type {\n  WalletModuleFactory,\n  WalletBehaviourFactory,\n  Transaction,\n  Network,\n  Account,\n  InjectedWallet,\n} from \"@near-wallet-selector/core\";\nimport { icon } from \"./icon\";\nimport { createBitteWalletConnector } from \"./bitte-wallet\";\nimport { BitteWalletExtraOptions, BitteWalletParams, BitteWalletState } from \"./types\";\n\nconst resolveWalletUrl = (network?: Network, walletUrl?: string) => {\n  if (walletUrl) {\n    return walletUrl;\n  }\n\n  if(!network){\n    return \"https://wallet.bitte.ai\";\n  }\n\n  switch (network.networkId) {\n    case \"mainnet\":\n      return \"https://wallet.bitte.ai\";\n    case \"testnet\":\n      return \"https://testnet.wallet.bitte.ai\";\n    default:\n      return \"https://wallet.bitte.ai\";\n  }\n};\n\nconst setupWalletState = async (\n  params: BitteWalletExtraOptions,\n  network: Network\n): Promise<BitteWalletState> => {\n  // Use the factory function instead of the class constructor\n  const wallet = createBitteWalletConnector(params.walletUrl, network);\n\n  return {\n    wallet,\n  };\n};\n\nconst BitteWallet: WalletBehaviourFactory<\n  InjectedWallet,\n  { params: BitteWalletExtraOptions }\n> = async ({ metadata, options, store, params, logger }) => {\n  const state = await setupWalletState(params, options.network);\n\n  const getAccounts = async (): Promise<Array<Account>> => {\n    const accountId = state.wallet.getAccountId();\n    const publicKey = state.wallet.getPublicKey();\n\n    return [\n      {\n        accountId,\n        publicKey: publicKey ? publicKey.toString() : \"\",\n      },\n    ];\n  };\n\n  return {\n    async signIn({ contractId, methodNames }) {\n      if (!state.wallet.isSignedIn()) {\n        await state.wallet.requestSignIn({\n          contractId,\n          methodNames,\n        });\n      }\n\n      return getAccounts();\n    },\n\n    async signOut() {\n      state.wallet.signOut();\n    },\n\n    async getAccounts() {\n      return getAccounts();\n    },\n\n    async verifyOwner() {\n      throw new Error(`Method not supported by ${metadata.name}`);\n    },\n\n    async signMessage({\n      message,\n      nonce,\n      recipient,\n      callbackUrl,\n      state: sgnState,\n    }) {\n      logger.log(\"sign message\", { message });\n\n      return await state.wallet.signMessage({\n        message,\n        nonce,\n        recipient,\n        callbackUrl,\n        state: sgnState,\n      });\n    },\n\n    async signAndSendTransaction({ signerId, receiverId, actions }) {\n      logger.log(\"signAndSendTransaction\", {\n        signerId,\n        receiverId,\n        actions,\n      });\n\n      const { contract } = store.getState();\n\n      if (!state.wallet.isSignedIn() || !contract) {\n        throw new Error(\"Wallet not signed in\");\n      }\n\n      const signedAccountId = state.wallet.getAccountId();\n\n      if (signerId && signedAccountId !== signerId) {\n        throw new Error(\n          `Signed in as ${signedAccountId}, cannot sign for ${signerId}`\n        );\n      }\n\n      return state.wallet.signAndSendTransaction({\n        receiverId: receiverId || contract.contractId,\n        actions,\n      });\n    },\n\n    async signAndSendTransactions({ transactions }) {\n      logger.log(\"signAndSendTransactions\", { transactions });\n\n      if (!state.wallet.isSignedIn()) {\n        throw new Error(\"Wallet not signed in\");\n      }\n\n      return state.wallet.signAndSendTransactions(\n        transactions as Array<Transaction>\n      );\n    },\n\n    buildImportAccountsUrl() {\n      return `${params.walletUrl}/batch-import`;\n    },\n  };\n};\n\nexport function setupBitteWallet({\n  walletUrl,\n  iconUrl = icon,\n  deprecated = false,\n}: BitteWalletParams = {}): WalletModuleFactory<InjectedWallet> {\n  return async (moduleOptions) => {\n    return {\n      id: \"bitte-wallet\",\n      type: \"injected\",\n      metadata: {\n        name: \"Bitte Wallet\",\n        description:\n          \"NEAR wallet to store, buy, send and stake assets for DeFi.\",\n        iconUrl,\n        deprecated,\n        available: true,\n        downloadUrl: resolveWalletUrl(moduleOptions.options.network, walletUrl),\n      },\n      init: (options) => {\n        return BitteWallet({\n          ...options,\n          params: {\n            walletUrl: resolveWalletUrl(moduleOptions.options.network, walletUrl),\n          },\n        });\n      },\n    };\n  };\n}"]}