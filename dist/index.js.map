{"version":3,"sources":["../src/icon.ts","../src/bitte-wallet.ts","../src/bitte-wallet-setup.ts"],"names":["icon","DEFAULT_POPUP_WIDTH","DEFAULT_POPUP_HEIGHT","POLL_INTERVAL","getInitialState","saveState","state","createWalletConfig","walletUrl","network","providers","getAccountId","getPublicKey","KeyPair","isSignedIn","signOut","newState","requestSignInUrl","config","contractId","methodNames","currentUrl","newUrl","functionCallKey","accessKey","methodName","requestSignIn","url","handlePopupTransaction","data","responseData","publicKey","accountId","updatedState","signMessage","message","nonce","recipient","callbackUrl","messageState","href","value","completeTransaction","receiverId","actions","block","blockHash","serialize","transactions","a","createAction","storedKeyCanSign","signUsingKeyPair","myKeyStore","keyStores","keyPair","connect","requestSignTransactionsUrl","txs","stringifiedParam","urlParam","signAndSendTransactionsPopUp","txsHashes","hash","signAndSendTransaction","error","tx","signAndSendTransactions","transactionsWS","setupMessageHandler","resolve","reject","childWindow","callback","event","origin","walletBaseUrl","screenWidth","screenHeight","left","top","messageHandler","intervalId","createBitteWalletConnector","params","result","resolveWalletUrl","setupWalletState","BitteWallet","metadata","options","store","logger","getAccounts","sgnState","signerId","contract","signedAccountId","setupBitteWallet","iconUrl","deprecated","moduleOptions"],"mappings":"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","file":"index.js","sourcesContent":["export const icon = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTUiIGhlaWdodD0iOTUiIHZpZXdCb3g9IjAgMCA5NSA5NSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xLjc3NjE3IDU5LjE4MjZMNjIuNzIyNyA2My4zMTNDNjMuMTE4NSA2My40MzA5IDYzLjQ3ODggNjMuNjQ1NiA2My43NzA4IDYzLjkzNzdDNjQuMDYyOSA2NC4yMjk3IDY0LjI3NzUgNjQuNTg5OSA2NC4zOTU0IDY0Ljk4NThMNjguNTI1OSA3OC44NTU1QzY4LjY3ODcgNzkuMzY4NiA2OC45OTMyIDc5LjgxODYgNjkuNDIyNCA4MC4xMzg3QzY5Ljg1MTYgODAuNDU4NyA3MC4zNzI3IDgwLjYzMTYgNzAuOTA4MiA4MC42MzE2QzcxLjQ0MzYgODAuNjMxNiA3MS45NjQ3IDgwLjQ1ODcgNzIuMzkzOSA4MC4xMzg3QzcyLjgyMzEgNzkuODE4NiA3My4xMzc2IDc5LjM2ODYgNzMuMjkwNCA3OC44NTU1TDc3LjQyMDkgNjQuOTg1OEM3Ny41Mzg4IDY0LjU4OTkgNzcuNzUzNCA2NC4yMjk3IDc4LjA0NTUgNjMuOTM3N0M3OC4zMzc2IDYzLjY0NTYgNzguNjk3OCA2My40MzA5IDc5LjA5MzYgNjMuMzEzTDkyLjk2MzMgNTkuMTgyNkM5My40NzY0IDU5LjAyOTcgOTMuOTI2NSA1OC43MTUzIDk0LjI0NjYgNTguMjg2MUM5NC41NjY2IDU3Ljg1NjggOTQuNzM5NSA1Ny4zMzU3IDk0LjczOTUgNTYuODAwM0M5NC43Mzk1IDU2LjI2NDkgOTQuNTY2NiA1NS43NDM4IDk0LjI0NjYgNTUuMzE0NkM5My45MjY1IDU0Ljg4NTMgOTMuNDc2NCA1NC41NzA5IDkyLjk2MzMgNTQuNDE4MUw3OS4wOTM3IDUwLjI4NzZDNzguNjk3OCA1MC4xNjk3IDc4LjMzNzYgNDkuOTU1IDc4LjA0NTUgNDkuNjYzQzc3Ljc1MzUgNDkuMzcwOSA3Ny41Mzg4IDQ5LjAxMDcgNzcuNDIwOSA0OC42MTQ4TDczLjI5MDQgMzQuNzQ1MkM3My4xMzc2IDM0LjIzMiA3Mi44MjMyIDMzLjc4MTkgNzIuMzkzOSAzMy40NjE5QzcxLjk2NDcgMzMuMTQxOSA3MS40NDM2IDMyLjk2OSA3MC45MDgyIDMyLjk2OUM3MC4zNzI4IDMyLjk2OSA2OS44NTE3IDMzLjE0MTkgNjkuNDIyNCAzMy40NjE5QzY4Ljk5MzIgMzMuNzgxOSA2OC42Nzg4IDM0LjIzMiA2OC41MjYgMzQuNzQ1Mkw2NC4zOTU0IDQ4LjYxNDhDNjQuMjc3NiA0OS4wMTA3IDY0LjA2MjkgNDkuMzcwOSA2My43NzA4IDQ5LjY2M0M2My40Nzg4IDQ5Ljk1NSA2My4xMTg1IDUwLjE2OTcgNjIuNzIyNyA1MC4yODc2TDEuNzc2MTggNTQuNDE4MUMxLjI2MzA1IDU0LjU3MDkgMC44MTI5NTYgNTQuODg1MyAwLjQ5MjkyIDU1LjMxNDZDMC4xNzI4ODQgNTUuNzQzOCAyLjI0NzU1ZS0wNiA1Ni4yNjQ5IDAgNTYuODAwM0MtMi4yNDc1MWUtMDYgNTcuMzM1NyAwLjE3Mjg4NyA1Ny44NTY4IDAuNDkyOTIgNTguMjg2MUMwLjgxMjk1MyA1OC43MTUzIDEuMjYzMDMgNTkuMDI5NyAxLjc3NjE3IDU5LjE4MjZaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMyLjE2MzcgMjkuNDg2OEw0MC4zNTc4IDMxLjkyNzFDNDAuNTkxNyAzMS45OTY3IDQwLjgwNDUgMzIuMTIzNiA0MC45NzcgMzIuMjk2MUM0MS4xNDk2IDMyLjQ2ODcgNDEuMjc2NCAzMi42ODE1IDQxLjM0NjEgMzIuOTE1NEw0My43ODYzIDQxLjEwOTVDNDMuODc2NiA0MS40MTI2IDQ0LjA2MjQgNDEuNjc4NSA0NC4zMTYgNDEuODY3NkM0NC41Njk2IDQyLjA1NjcgNDQuODc3NCA0Mi4xNTg4IDQ1LjE5MzcgNDIuMTU4OEM0NS41MTAxIDQyLjE1ODggNDUuODE3OSA0Mi4wNTY3IDQ2LjA3MTUgNDEuODY3NkM0Ni4zMjUxIDQxLjY3ODUgNDYuNTEwOSA0MS40MTI2IDQ2LjYwMTEgNDEuMTA5NUw0OS4wNDE0IDMyLjkxNTRDNDkuMTExMSAzMi42ODE1IDQ5LjIzNzkgMzIuNDY4NyA0OS40MTA0IDMyLjI5NjFDNDkuNTgzIDMyLjEyMzYgNDkuNzk1OCAzMS45OTY3IDUwLjAyOTcgMzEuOTI3MUw1OC4yMjM4IDI5LjQ4NjhDNTguNTI2OSAyOS4zOTY2IDU4Ljc5MjggMjkuMjEwOCA1OC45ODE5IDI4Ljk1NzJDNTkuMTcxIDI4LjcwMzYgNTkuMjczMSAyOC4zOTU4IDU5LjI3MzEgMjguMDc5NEM1OS4yNzMxIDI3Ljc2MzEgNTkuMTcxIDI3LjQ1NTMgNTguOTgxOSAyNy4yMDE3QzU4Ljc5MjggMjYuOTQ4MSA1OC41MjY5IDI2Ljc2MjMgNTguMjIzOCAyNi42NzJMNTAuMDI5NiAyNC4yMzE3QzQ5Ljc5NTggMjQuMTYyMSA0OS41ODI5IDI0LjAzNTIgNDkuNDEwNCAyMy44NjI3QzQ5LjIzNzkgMjMuNjkwMiA0OS4xMTEgMjMuNDc3MyA0OS4wNDE0IDIzLjI0MzRMNDYuNjAxMSAxNS4wNDkzQzQ2LjUxMDggMTQuNzQ2MiA0Ni4zMjUgMTQuNDgwMyA0Ni4wNzE1IDE0LjI5MTJDNDUuODE3OSAxNC4xMDIxIDQ1LjUxIDE0IDQ1LjE5MzcgMTRDNDQuODc3NCAxNCA0NC41Njk1IDE0LjEwMjEgNDQuMzE1OSAxNC4yOTEyQzQ0LjA2MjMgMTQuNDgwMyA0My44NzY2IDE0Ljc0NjIgNDMuNzg2MyAxNS4wNDkzTDQxLjM0NiAyMy4yNDM0QzQxLjI3NjQgMjMuNDc3MyA0MS4xNDk1IDIzLjY5MDIgNDAuOTc3IDIzLjg2MjdDNDAuODA0NCAyNC4wMzUyIDQwLjU5MTYgMjQuMTYyMSA0MC4zNTc4IDI0LjIzMTdMMzIuMTYzNyAyNi42NzJDMzEuODYwNSAyNi43NjIyIDMxLjU5NDYgMjYuOTQ4IDMxLjQwNTUgMjcuMjAxNkMzMS4yMTY0IDI3LjQ1NTIgMzEuMTE0MyAyNy43NjMxIDMxLjExNDMgMjguMDc5NEMzMS4xMTQzIDI4LjM5NTggMzEuMjE2NCAyOC43MDM3IDMxLjQwNTUgMjguOTU3MkMzMS41OTQ2IDI5LjIxMDggMzEuODYwNSAyOS4zOTY2IDMyLjE2MzcgMjkuNDg2OFoiIGZpbGw9ImJsYWNrIi8+Cjwvc3ZnPgo=';\n","import type {\n  Action,\n  FinalExecutionOutcome,\n  Network,\n  SignMessageParams,\n  Transaction,\n} from \"@near-wallet-selector/core\";\n import { createAction } from \"@near-wallet-selector/wallet-utils\";\nimport { connect, keyStores, providers, transactions } from \"near-api-js\";\nimport type { PublicKey } from \"near-api-js/lib/utils\";\nimport { KeyPair, serialize } from \"near-api-js/lib/utils\";\nimport { WalletConfig, WalletMessage, WalletResponseData, WalletState } from \"./types\";\nimport type { Transaction as WalletSelectorTransaction, Action as WalletSelectorAction } from \"@near-wallet-selector/core\";\n\n\n// Constants\nconst DEFAULT_POPUP_WIDTH = 480;\nconst DEFAULT_POPUP_HEIGHT = 640;\nconst POLL_INTERVAL = 300;\n\n\n// State management\nconst getInitialState = (): WalletState => ({\n  signedAccountId: localStorage.getItem(\"signedAccountId\") || \"\",\n  functionCallKey: JSON.parse(localStorage.getItem(\"functionCallKey\") || \"null\"),\n});\n\nconst saveState = (state: WalletState): void => {\n  localStorage.setItem(\"signedAccountId\", state.signedAccountId);\n  localStorage.setItem(\"functionCallKey\", JSON.stringify(state.functionCallKey));\n};\n\n// Create wallet configuration\nconst createWalletConfig = (walletUrl: string, network: Network): WalletConfig => ({\n  walletUrl,\n  network,\n  provider: new providers.JsonRpcProvider({ url: network.nodeUrl }),\n});\n\n// Core functions\nconst getAccountId = (state: WalletState): string => {\n  return state.signedAccountId;\n};\n\nconst getPublicKey = (state: WalletState): PublicKey | undefined => {\n  if (state.functionCallKey) {\n    return KeyPair.fromString(state.functionCallKey.privateKey).getPublicKey();\n  }\n  return undefined;\n};\n\nconst isSignedIn = (state: WalletState): boolean => {\n  return !!state.signedAccountId;\n};\n\nconst signOut = (): WalletState => {\n  const newState = {\n    signedAccountId: \"\",\n    functionCallKey: null,\n  };\n  saveState(newState);\n  return newState;\n};\n\nconst requestSignInUrl = (\n  config: WalletConfig,\n  { contractId, methodNames }: { contractId: string; methodNames?: Array<string> }\n): { url: string; newState: WalletState } => {\n  const currentUrl = new URL(window.location.href);\n  const newUrl = new URL(`${config.walletUrl}/login/`);\n\n  newUrl.searchParams.set(\"success_url\", currentUrl.href);\n  newUrl.searchParams.set(\"failure_url\", currentUrl.href);\n\n  let functionCallKey = null;\n\n  if (contractId) {\n    newUrl.searchParams.set(\"contract_id\", contractId);\n\n    const accessKey = KeyPair.fromRandom(\"ed25519\");\n    newUrl.searchParams.set(\n      \"public_key\",\n      accessKey.getPublicKey().toString()\n    );\n\n    functionCallKey = {\n      privateKey: accessKey.toString(),\n      contractId,\n      methods: methodNames || [],\n    };\n  }\n\n  if (methodNames) {\n    methodNames.forEach((methodName) => {\n      newUrl.searchParams.append(\"methodNames\", methodName);\n    });\n  }\n\n  const newState = getInitialState();\n  newState.functionCallKey = functionCallKey;\n  saveState(newState);\n\n  return { url: newUrl.toString(), newState };\n};\n\nconst requestSignIn = async (\n  config: WalletConfig,\n  state: WalletState,\n  { contractId, methodNames }: { contractId: string; methodNames?: Array<string> }\n): Promise<Array<{ accountId: string; publicKey: string }>> => {\n  const { url, newState } = requestSignInUrl(config, { contractId, methodNames });\n\n  return handlePopupTransaction(config, url, async (data) => {\n    const responseData = data as WalletResponseData;\n    const { public_key: publicKey, account_id: accountId } = responseData;\n\n    if (accountId) {\n      const updatedState = { ...newState, signedAccountId: accountId };\n      saveState(updatedState);\n      return [{ accountId, publicKey: publicKey || \"\" }];\n    }\n    throw new Error(\"Invalid response data from wallet\");\n  });\n};\n\nconst signMessage = async (\n  config: WalletConfig,\n  { message, nonce, recipient, callbackUrl, state: messageState }: SignMessageParams\n) => {\n  const url = callbackUrl || window.location.href;\n\n  if (!url) {\n    throw new Error(`BitteWallet: CallbackUrl is missing`);\n  }\n\n  const href = new URL(config.walletUrl);\n  href.pathname = \"sign-message\";\n  href.searchParams.append(\"message\", message);\n  href.searchParams.append(\"nonce\", nonce.toString(\"base64\"));\n  href.searchParams.append(\"recipient\", recipient);\n  href.searchParams.append(\"callbackUrl\", url);\n\n  if (messageState) {\n    href.searchParams.append(\"state\", messageState);\n  }\n\n  return handlePopupTransaction(config, href.toString(), (value) => {\n    return {\n      accountId: value?.signedRequest?.accountId || \"\",\n      publicKey: value?.signedRequest?.publicKey || \"\",\n      signature: value?.signedRequest?.signature || \"\",\n    };\n  });\n};\n\nconst completeTransaction = async (\n  config: WalletConfig,\n  state: WalletState,\n  { receiverId, actions }: { receiverId: string; actions: Array<Action> }\n): Promise<transactions.Transaction> => {\n  // To create a transaction we need a recent block\n  const block = await config.provider.block({ finality: \"final\" });\n  const blockHash = serialize.base_decode(block.header.hash);\n\n  // create Transaction for the wallet\n  return transactions.createTransaction(\n    state.signedAccountId,\n    KeyPair.fromRandom(\"ed25519\").getPublicKey(),\n    receiverId,\n    0,\n    actions.map((a) => createAction(a)),\n    Uint8Array.from(blockHash)\n  );\n};\n\nconst storedKeyCanSign = (\n  state: WalletState,\n  receiverId: string,\n  actions: Array<Action>\n): boolean => {\n  if (\n    state.functionCallKey &&\n    state.functionCallKey.contractId === receiverId\n  ) {\n    return (\n      actions[0].type === \"FunctionCall\" &&\n      actions[0].params.deposit === \"0\" &&\n      (state.functionCallKey.methods.length === 0 ||\n        state.functionCallKey.methods.includes(actions[0].params.methodName))\n    );\n  }\n  return false;\n};\n\nconst signUsingKeyPair = async (\n  config: WalletConfig,\n  state: WalletState,\n  { receiverId, actions }: { receiverId: string; actions: Array<Action> }\n): Promise<FinalExecutionOutcome> => {\n  // instantiate an account (NEAR API is a nightmare)\n  const myKeyStore = new keyStores.InMemoryKeyStore();\n  const keyPair = KeyPair.fromString(state.functionCallKey!.privateKey as any);\n\n  await myKeyStore.setKey(\n    config.network.networkId,\n    state.signedAccountId,\n    keyPair\n  );\n\n  const near = await connect({ ...config.network, keyStore: myKeyStore });\n  const account = await near.account(state.signedAccountId);\n\n  return account.signAndSendTransaction({\n    receiverId,\n    actions: actions.map((a) => createAction(a)),\n  });\n};\n\nconst requestSignTransactionsUrl = (\n  config: WalletConfig,\n  txs:  Array<Transaction>\n): string => {\n  const newUrl = new URL(`${config.walletUrl}/sign-transaction`);\n\n  const stringifiedParam = JSON.stringify(txs);\n  const urlParam = encodeURIComponent(stringifiedParam);\n\n  newUrl.searchParams.set('transactions_data', urlParam);\n  newUrl.searchParams.set('callback_url', window.location.origin);\n\n  return newUrl.toString();\n};\n\nconst signAndSendTransactionsPopUp = async (\n  config: WalletConfig,\n  txs: Array<Transaction>\n): Promise<Array<FinalExecutionOutcome>> => {\n  const url = requestSignTransactionsUrl(config, txs);\n  const txsHashes = (\n    await handlePopupTransaction(config, url, (data) => data.transactionHashes)\n  )?.split(\",\");\n\n  if (!txsHashes) {\n    throw new Error(\"No transaction hashes received\");\n  }\n  return Promise.all(\n    txsHashes.map((hash) => config.provider.txStatus(hash, \"unused\"))\n  );\n};\n\n\n\nconst signAndSendTransaction = async (\n  config: WalletConfig,\n  state: WalletState,\n  { receiverId, actions }: { receiverId: string; actions: Array<Action> }\n): Promise<FinalExecutionOutcome> => {\n  if (actions.length === 1 && storedKeyCanSign(state, receiverId, actions)) {\n    try {\n      return await signUsingKeyPair(config, state, { receiverId, actions });\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        \"Failed to sign using key pair, falling back to wallet\",\n        error\n      );\n    }\n  }\n\n\n  const tx = await completeTransaction(config, state, { receiverId, actions });\n\n  const results = await signAndSendTransactionsPopUp(config, [tx as any]);\n  return results[0];\n};\n\nconst signAndSendTransactions = async (\n  config: WalletConfig,\n  state: WalletState,\n  transactionsWS: Array<Transaction>\n): Promise<Array<FinalExecutionOutcome>> => {\n\n  return signAndSendTransactionsPopUp(config, transactionsWS);\n};\n\n// Helper functions\nconst setupMessageHandler = <T>(\n  config: WalletConfig,\n  resolve: (value: T) => void,\n  reject: (reason?: unknown) => void,\n  childWindow: Window | null,\n  callback: (result: WalletMessage) => T\n): (event: MessageEvent) => Promise<void> => {\n  const handler = async (event: MessageEvent) => {\n    const message = event.data as WalletMessage;\n\n    // check if the URL are the same\n    const origin = new URL(event.origin);\n    const walletBaseUrl = new URL(config.walletUrl);\n\n    if (origin.origin !== walletBaseUrl.origin) {\n      // eslint-disable-next-line no-console\n      console.warn(\"Ignoring message from different origin\", origin.origin);\n      return;\n    }\n\n    switch (message.status) {\n      case \"success\":\n        childWindow?.close();\n        resolve(callback(message));\n        break;\n      case \"failure\":\n        childWindow?.close();\n        reject(new Error(message.errorMessage || \"Transaction failed\"));\n        break;\n      default:\n        // eslint-disable-next-line no-console\n        console.warn(\"Unhandled message status:\", message.status);\n    }\n  };\n\n  return handler;\n};\n\nconst handlePopupTransaction = <T>(\n  config: WalletConfig,\n  url: string,\n  callback: (result: WalletMessage) => T\n): Promise<T> => {\n  const screenWidth = window.innerWidth || screen.width;\n  const screenHeight = window.innerHeight || screen.height;\n  const left = (screenWidth - DEFAULT_POPUP_WIDTH) / 2;\n  const top = (screenHeight - DEFAULT_POPUP_HEIGHT) / 2;\n\n  const childWindow = window.open(\n    url,\n    \"BitteWallet\",\n    `width=${DEFAULT_POPUP_WIDTH},height=${DEFAULT_POPUP_HEIGHT},top=${top},left=${left}`\n  );\n\n  if (!childWindow) {\n    throw new Error(\n      \"Popup window blocked. Please allow popups for this site.\"\n    );\n  }\n\n  return new Promise<T>((resolve, reject) => {\n    const messageHandler = setupMessageHandler(\n      config,\n      resolve,\n      reject,\n      childWindow,\n      callback\n    );\n\n    window.addEventListener(\"message\", messageHandler);\n\n    const intervalId = setInterval(() => {\n      if (childWindow.closed) {\n        window.removeEventListener(\"message\", messageHandler);\n        clearInterval(intervalId);\n        reject(new Error(\"User closed the window\"));\n      }\n    }, POLL_INTERVAL);\n  });\n};\n\n\nexport const createBitteWalletConnector = (walletUrl: string, network: Network) => {\n  const config = createWalletConfig(walletUrl, network);\n  let state = getInitialState();\n\n  return {\n    getAccountId: () => getAccountId(state),\n    getPublicKey: () => getPublicKey(state),\n    isSignedIn: () => isSignedIn(state),\n    signOut: () => {\n      state = signOut();\n      return null;\n    },\n    requestSignIn: async (params: { contractId: string; methodNames?: Array<string> }) => {\n      const result = await requestSignIn(config, state, params);\n      // Update state after sign-in\n      state = getInitialState();\n      return result;\n    },\n    requestSignInUrl: (params: { contractId: string; methodNames?: Array<string> }) => {\n      const { url, newState } = requestSignInUrl(config, params);\n      state = newState;\n      return url;\n    },\n    signMessage: (params: SignMessageParams) => signMessage(config, params),\n    signAndSendTransaction: (params: { receiverId: string; actions: Array<Action> }) =>\n      signAndSendTransaction(config, state, params),\n    signAndSendTransactions: (transactions: Array<Transaction>) =>\n      signAndSendTransactions(config, state, transactions),\n  };\n};","import type {\n  WalletModuleFactory,\n  WalletBehaviourFactory,\n  Transaction,\n  Network,\n  Account,\n  InjectedWallet,\n} from \"@near-wallet-selector/core\";\nimport { icon } from \"./icon\";\nimport { createBitteWalletConnector } from \"./bitte-wallet\";\nimport { BitteWalletExtraOptions, BitteWalletParams, BitteWalletState } from \"./types\";\n\n\n\nconst resolveWalletUrl = (network: Network, walletUrl?: string) => {\n  if (walletUrl) {\n    return walletUrl;\n  }\n\n  switch (network.networkId) {\n    case \"mainnet\":\n      return \"https://wallet.bitte.ai\";\n    case \"testnet\":\n      return \"https://testnet.wallet.bitte.ai\";\n    default:\n      throw new Error(\"Invalid wallet url\");\n  }\n};\n\nconst setupWalletState = async (\n  params: BitteWalletExtraOptions,\n  network: Network\n): Promise<BitteWalletState> => {\n  // Use the factory function instead of the class constructor\n  const wallet = createBitteWalletConnector(params.walletUrl, network);\n\n  return {\n    wallet,\n  };\n};\n\nconst BitteWallet: WalletBehaviourFactory<\n  InjectedWallet,\n  { params: BitteWalletExtraOptions }\n> = async ({ metadata, options, store, params, logger }) => {\n  const state = await setupWalletState(params, options.network);\n\n  const getAccounts = async (): Promise<Array<Account>> => {\n    const accountId = state.wallet.getAccountId();\n    const publicKey = state.wallet.getPublicKey();\n\n    return [\n      {\n        accountId,\n        publicKey: publicKey ? publicKey.toString() : \"\",\n      },\n    ];\n  };\n\n  return {\n    async signIn({ contractId, methodNames }) {\n      if (!state.wallet.isSignedIn()) {\n        await state.wallet.requestSignIn({\n          contractId,\n          methodNames,\n        });\n      }\n\n      return getAccounts();\n    },\n\n    async signOut() {\n      state.wallet.signOut();\n    },\n\n    async getAccounts() {\n      return getAccounts();\n    },\n\n    async verifyOwner() {\n      throw new Error(`Method not supported by ${metadata.name}`);\n    },\n\n    async signMessage({\n      message,\n      nonce,\n      recipient,\n      callbackUrl,\n      state: sgnState,\n    }) {\n      logger.log(\"sign message\", { message });\n\n      return await state.wallet.signMessage({\n        message,\n        nonce,\n        recipient,\n        callbackUrl,\n        state: sgnState,\n      });\n    },\n\n    async signAndSendTransaction({ signerId, receiverId, actions }) {\n      logger.log(\"signAndSendTransaction\", {\n        signerId,\n        receiverId,\n        actions,\n      });\n\n      const { contract } = store.getState();\n\n      if (!state.wallet.isSignedIn() || !contract) {\n        throw new Error(\"Wallet not signed in\");\n      }\n\n      const signedAccountId = state.wallet.getAccountId();\n\n      if (signerId && signedAccountId !== signerId) {\n        throw new Error(\n          `Signed in as ${signedAccountId}, cannot sign for ${signerId}`\n        );\n      }\n\n      console.log(actions, 'actions')\n\n      return state.wallet.signAndSendTransaction({\n        receiverId: receiverId || contract.contractId,\n        actions,\n      });\n    },\n\n    async signAndSendTransactions({ transactions }) {\n      logger.log(\"signAndSendTransactions\", { transactions });\n\n      if (!state.wallet.isSignedIn()) {\n        throw new Error(\"Wallet not signed in\");\n      }\n\n      return state.wallet.signAndSendTransactions(\n        transactions as Array<Transaction>\n      );\n    },\n\n    buildImportAccountsUrl() {\n      return `${params.walletUrl}/batch-import`;\n    },\n  };\n};\n\nexport function setupBitteWallet({\n  walletUrl,\n  iconUrl = icon,\n  deprecated = false,\n}: BitteWalletParams = {}): WalletModuleFactory<InjectedWallet> {\n  return async (moduleOptions) => {\n    return {\n      id: \"bitte-wallet\",\n      type: \"injected\",\n      metadata: {\n        name: \"Bitte Wallet\",\n        description:\n          \"NEAR wallet to store, buy, send and stake assets for DeFi.\",\n        iconUrl,\n        deprecated,\n        available: true,\n        downloadUrl: resolveWalletUrl(moduleOptions.options.network, walletUrl),\n      },\n      init: (options) => {\n        return BitteWallet({\n          ...options,\n          params: {\n            walletUrl: resolveWalletUrl(moduleOptions.options.network, walletUrl),\n          },\n        });\n      },\n    };\n  };\n}"]}