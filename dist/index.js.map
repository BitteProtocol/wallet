{"version":3,"sources":["../src/utils.ts","../src/bitte-wallet.ts","../src/bitte-wallet-setup.ts"],"names":["checkCallbackUrl","callbackUrl","isValidURL","url","globalCallBackUrl","getCallbackUrl","mbjsCallbackUrl","globalCBUrl","resolveBitteWallet","network","walletUrl","BitteWallet","metadata","options","successUrl","failureUrl","contractId","callback","networkId","state","connect","WalletConnection","keyStores","nearAPI","connectionConfig","acc","nearConnection","wallet","activeAccountId","getAccountId","isSignedIn","signIn","existingAccounts","getAccounts","href","signOut","assertValidSigner","signerId","signAndSendTransactions","transactions","cbUrl","stringifiedParam","urlParam","newUrl","signAndSendTransaction","receiverId","actions","action","createAction","verifyOwner","signMessage","message","nonce","recipient","verifyMessage","accountId","publicKey","signature","data","isValid","getAvailableBalance","account","currentAccount","switchAccount","id","setActiveAccountId","icon","setupBitteWallet","deprecated","moduleOptions"],"mappings":"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","file":"index.js","sourcesContent":["/*\n    Mintbase Wallet Utils file\n*/\n\n\nconst checkCallbackUrlBitte = (callbackUrl: string): string => {\n  function isValidURL(url): boolean {\n    const urlPattern = /^(https?|ftp|http?):\\/\\/[^\\s/$.?#].[^\\s]*$/;\n    return urlPattern.test(url);\n  }\n\n  if (callbackUrl !== null && callbackUrl.length > 0) {\n    if (isValidURL(callbackUrl)) {\n      if (\n        callbackUrl.startsWith('https://') ||\n        callbackUrl.startsWith('http://')\n      ) {\n        return callbackUrl.endsWith('/')\n          ? callbackUrl.slice(0, -1)\n          : callbackUrl;\n      }\n    } else {\n      console.error(\n        'callbackUrl set with wrong format. please use an URL with http:// or https:// instead.Further help available on our telegram channel: https://t.me/mintdev',\n      );\n      return new URL(window.location.href).toString();\n    }\n  } else {\n    const globalCallBackUrl = localStorage.getItem(\n      'bitte-wallet:callback_url',\n    );\n\n    if (isValidURL(globalCallBackUrl)) {\n      return globalCallBackUrl;\n    } else {\n      console.warn('We recommend you to set the callbackUrl property on setupMintbaseWallet  \\n read more here:  \\n https://docs.mintbase.xyz/dev/mintbase-sdk-ref/wallet#setupmintbasewallet  \\n  \\n further help available on our telegram channel:  \\n https://t.me/mintdev');\n      return new URL(window.location.href).toString();\n    }\n  }\n\n  return new URL(window.location.href).toString();\n};\n\n\nconst checkCallbackUrl = (callbackUrl: string): string => {\n  function isValidURL(url): boolean {\n    const urlPattern = /^(https?|ftp|http?):\\/\\/[^\\s/$.?#].[^\\s]*$/;\n    return urlPattern.test(url);\n  }\n\n  if (callbackUrl !== null && callbackUrl.length > 0) {\n    if (isValidURL(callbackUrl)) {\n      if (\n        callbackUrl.startsWith('https://') ||\n        callbackUrl.startsWith('http://')\n      ) {\n        return callbackUrl.endsWith('/')\n          ? callbackUrl.slice(0, -1)\n          : callbackUrl;\n      }\n    } else {\n      console.error(\n        'callbackUrl set with wrong format. please use an URL with http:// or https:// instead.Further help available on our telegram channel: https://t.me/mintdev',\n      );\n      return new URL(window.location.href).toString();\n    }\n  } else {\n    const globalCallBackUrl = localStorage.getItem(\n      'mintbase-wallet:callback_url',\n    );\n\n    if (isValidURL(globalCallBackUrl)) {\n      return globalCallBackUrl;\n    } else {\n      console.warn('We recommend you to set the callbackUrl property on setupMintbaseWallet  \\n read more here:  \\n https://docs.mintbase.xyz/dev/mintbase-sdk-ref/wallet#setupmintbasewallet  \\n  \\n further help available on our telegram channel:  \\n https://t.me/mintdev');\n      return new URL(window.location.href).toString();\n    }\n  }\n\n  return new URL(window.location.href).toString();\n};\n\nconst getCallbackUrl = (callbackUrl?: string): { cbUrl: string } | null => {\n  if (typeof window !== undefined) {\n\n    let mbjsCallbackUrl =  '';\n\n    if ( window?.['mbjs']?.keys?.callbackUrl && window?.['mbjs']?.keys?.callbackUrl.length > 0  ) {\n      mbjsCallbackUrl = window?.['mbjs']?.keys?.callbackUrl;\n    }\n\n    const globalCBUrl =  localStorage?.getItem('mintbase-wallet:callback_url') || mbjsCallbackUrl;\n\n    // it gets always the passed callBackUrl first, if not check for the one on the Wallet Setup or mbjs.keys.callbackUrl\n    const finalcbURL = callbackUrl ?? globalCBUrl;\n\n    const callBackUrlRes = checkCallbackUrl(finalcbURL);\n\n    // check if callBackUrl sent on the method is valid\n    // method callbackUrl will always have priority over global callbackUrl , user can set different callbackUrls according to the method..\n\n    return { cbUrl: callBackUrlRes };\n  }\n  return null;\n};\n\nconst getCallbackUrlBitte = (callbackUrl?: string): { cbUrl: string } | null => {\n  if (typeof window !== undefined) {\n\n    let mbjsCallbackUrl =  '';\n\n    if ( window?.['mbjs']?.keys?.callbackUrl && window?.['mbjs']?.keys?.callbackUrl.length > 0  ) {\n      mbjsCallbackUrl = window?.['mbjs']?.keys?.callbackUrl;\n    }\n\n    const globalCBUrl =  localStorage?.getItem('bitte-wallet:callback_url') || mbjsCallbackUrl;\n\n    // it gets always the passed callBackUrl first, if not check for the one on the Wallet Setup or mbjs.keys.callbackUrl\n    const finalcbURL = callbackUrl ?? globalCBUrl;\n\n    const callBackUrlRes = checkCallbackUrlBitte(finalcbURL);\n\n    // check if callBackUrl sent on the method is valid\n    // method callbackUrl will always have priority over global callbackUrl , user can set different callbackUrls according to the method..\n\n    return { cbUrl: callBackUrlRes };\n  }\n  return null;\n};\n\nconst resolveWalletUrl = (network: string, walletUrl?: string): string  => {\n  if (walletUrl) {\n    return walletUrl;\n  }\n\n  switch (network) {\n  case 'mainnet':\n    return 'https://wallet.mintbase.xyz';\n  case 'testnet':\n    return 'https://testnet.wallet.mintbase.xyz/';\n  default:\n    throw new Error('Invalid wallet url');\n  }\n};\n\nconst resolveBitteWallet = (network: string, walletUrl?: string): string  => {\n  if (walletUrl) {\n    return walletUrl;\n  }\n\n  switch (network) {\n  case 'mainnet':\n    return 'https://wallet.bitte.ai';\n  case 'testnet':\n    return 'https://testnet.wallet.bitte.ai/';\n  default:\n    throw new Error('Invalid wallet url');\n  }\n};\n\nexport { checkCallbackUrl,checkCallbackUrlBitte,  getCallbackUrl,getCallbackUrlBitte, resolveBitteWallet, resolveWalletUrl };\n\n","import * as nearAPI from 'near-api-js';\n\nimport type {\n  Action,\n  BrowserWallet,\n  FinalExecutionOutcome,\n  WalletBehaviourFactory,\n} from '@near-wallet-selector/core';\nimport { getCallbackUrl } from './utils';\nimport { createAction } from '@near-wallet-selector/wallet-utils';\n\n\nexport enum TransactionSuccessEnum {\n  MINT = 'mint',\n  TRANSFER = 'transfer',\n  BURN = 'burn',\n  DEPLOY_STORE = 'deploy-store',\n  MAKE_OFFER = 'make-offer',\n  REVOKE_MINTER = 'revoke-minter',\n  ADD_MINTER = 'add-minter',\n  TRANSFER_STORE_OWNERSHIP = 'transfer-store-ownership',\n  AUCTION_LIST = 'list',\n  SIMPLE_SALE_LIST = 'simple-sale-list',\n  UNLIST = 'unlist',\n  TAKE_OFFER = 'take-offer',\n  WITHDRAW_OFFER = 'withdraw-offer',\n}\n\ninterface BitteWalletState {\n  wallet: nearAPI.WalletConnection;\n}\n\ninterface BitteWalletAccount {\n  accountId: string;\n  publicKey: string;\n}\n\nexport type CallBackArgs = {\n  args:  Record<string, unknown>;\n  type: TransactionSuccessEnum;\n}\n\n\nexport const BitteWallet: WalletBehaviourFactory<\n  BrowserWallet,\n  {\n    networkId: string;\n    callback: string;\n    successUrl?: string;\n    failureUrl?: string;\n    contractId?: string;\n  }\n> = async ({\n  metadata,\n  options,\n  successUrl,\n  failureUrl,\n  contractId,\n  callback,\n  networkId,\n}) => {\n\n  const setupWalletState = async (): Promise<BitteWalletState> | null => {\n    if (typeof window !== undefined) {\n      const { connect, WalletConnection, keyStores } = nearAPI;\n      const connectionConfig = {\n        networkId: networkId,\n        keyStore: new keyStores.BrowserLocalStorageKeyStore(),\n        nodeUrl: options.network.nodeUrl,\n        walletUrl: metadata.walletUrl,\n        headers: {},\n      };\n\n      const searchParams = new URL(window.location.href);\n      const acc = searchParams.searchParams.get('account_id');\n      //make near-api-js not throw without lak\n      if (acc && !contractId) {\n        localStorage.setItem(\n          'mintbase-wallet_wallet_auth_key',\n          JSON.stringify({\n            accountId: acc as string,\n            allKeys: [],\n          }),\n        );\n      }\n\n      const nearConnection = await connect(connectionConfig);\n      const wallet = new WalletConnection(nearConnection, 'mintbase-wallet');\n      localStorage.setItem('mintbase-wallet:callback_url', callback);\n\n      return {\n        wallet,\n      };\n    }\n\n    return null;\n  };\n\n  const state = await setupWalletState();\n\n  let activeAccountId: string;\n\n  const getAccountId = (): string => activeAccountId;\n\n  const isSignedIn = async (): Promise<boolean> => !!activeAccountId;\n\n  const signIn = async (): Promise<BitteWalletAccount[]> => {\n    const existingAccounts = await getAccounts();\n    const href = encodeURI(window?.location?.href);\n\n    if (existingAccounts.length) {\n      return existingAccounts;\n    }\n\n    await state.wallet.requestSignIn({\n      methodNames: [],\n      successUrl: successUrl || href,\n      failureUrl: failureUrl || href,\n      contractId: contractId,\n    });\n\n    return getAccounts();\n  };\n\n  const signOut = async (): Promise<void> => {\n    window.localStorage.removeItem('mintbase-wallet:account-data');\n\n    if (state.wallet.isSignedIn()) {\n      state.wallet.signOut();\n    }\n\n    return;\n  };\n\n\n  const assertValidSigner = (signerId: string): void => {\n    if (signerId && signerId !== state.wallet.getAccountId()) {\n      throw new Error(\n        `Cannot sign transactions for ${signerId} while signed in as ${activeAccountId}`,\n      );\n    }\n  };\n\n  const signAndSendTransactions = async ({ transactions, callbackUrl }): Promise<void> => {\n    if (!state.wallet.isSignedIn()) {\n      throw new Error('Wallet not signed in');\n    }\n    //// near-api-js code fails if no lak\n    // const { cbUrl } = getCallbackUrl(callbackUrl ?? '');\n\n    // return state.wallet.requestSignTransactions({\n    //   transactions: await transformTransactions(transactions),\n    //   callbackUrl: cbUrl,\n    // });\n\n    const { cbUrl } = getCallbackUrl(callbackUrl ?? '');\n\n    for (const { signerId } of transactions) {\n      assertValidSigner(signerId);\n    }\n    const stringifiedParam = JSON.stringify(transactions);\n\n    const urlParam = encodeURIComponent(stringifiedParam);\n    const newUrl = new URL(`${metadata.walletUrl}/sign-transaction`);\n    newUrl.searchParams.set('transactions_data', urlParam);\n    newUrl.searchParams.set('callback_url', cbUrl);\n\n    window.location.assign(newUrl.toString());\n    return;\n  };\n\n  const signAndSendTransaction =  async ({\n    receiverId,\n    actions,\n    signerId,\n    callbackUrl,\n  }: {\n    receiverId: string;\n    actions: Array<Action>;\n    signerId: string;\n    callbackUrl: string;\n  }): Promise<FinalExecutionOutcome> => {\n    assertValidSigner(signerId);\n\n    if (!receiverId && !contractId) {\n      throw new Error('No receiver found to send the transaction to');\n    }\n\n    const { cbUrl } = getCallbackUrl(callbackUrl ?? '');\n\n    const callback = cbUrl || successUrl;\n\n    if (!contractId) {\n      const newUrl = new URL(`${metadata.walletUrl}/sign-transaction`);\n      const stringifiedParam = JSON.stringify([{ receiverId, signerId, actions }]);\n      const urlParam = encodeURIComponent(stringifiedParam);\n      newUrl.searchParams.set('transactions_data', urlParam);\n      newUrl.searchParams.set('callback_url', callback);\n      window.location.assign(newUrl.toString());\n    }\n    const account = state.wallet.account();\n\n    return await account.signAndSendTransaction({\n      receiverId: receiverId || contractId,\n      actions: actions.map((action) => createAction(action)) as any,\n      walletCallbackUrl: callback,\n    });\n  };\n\n\n  const verifyOwner = async (): Promise<void> => {\n    throw new Error(`The verifyOwner method is not supported by ${metadata.name}`);\n  };\n\n  const signMessage = async ({ message, nonce, recipient, callbackUrl }): Promise<void> => {\n    const { cbUrl } = getCallbackUrl(callbackUrl ?? '');\n\n    const newUrl = new URL(`${metadata.walletUrl}/sign-message`);\n    newUrl.searchParams.set('message', message);\n    newUrl.searchParams.set('nonce', Buffer.from(nonce).toString('base64'));\n    newUrl.searchParams.set('recipient', recipient);\n    newUrl.searchParams.set('callbackUrl', cbUrl);\n    window.location.assign(newUrl.toString());\n  };\n\n  const verifyMessage = async ({ accountId, publicKey, signature, message, nonce, recipient, callbackUrl }): Promise<boolean> => {\n\n    const newUrl = new URL(`${metadata.walletUrl}/api/verify-message`);\n    newUrl.searchParams.set('message', message);\n    newUrl.searchParams.set('accountId', accountId);\n    newUrl.searchParams.set('publicKey', publicKey);\n    newUrl.searchParams.set('signature', signature);\n    newUrl.searchParams.set('nonce', Buffer.from(nonce).toString('base64'));\n    newUrl.searchParams.set('recipient', recipient);\n    newUrl.searchParams.set('callbackUrl', callbackUrl);\n\n    try {\n      const response = await fetch(newUrl.toString());\n      const data = await response.json();\n\n      const { isValid } = data;\n      return isValid;\n    } catch (e) {\n      return false;\n    }\n  };\n\n  const getAvailableBalance = async (): Promise<void> => {\n    // const accountId = state.wallet.getAccountId();\n    // return await getBalance(accountId);\n    throw (`The getAvailableBalance method is not supported by ${metadata.name}`);\n  };\n\n  const getAccounts = async (): Promise<BitteWalletAccount[]> => {\n    const accountId = state.wallet.getAccountId();\n    const account = state.wallet.account();\n\n    if (!accountId || !account) {\n      return [];\n    }\n\n    const currentAccount: string = window.localStorage.getItem(\n      'mintbase-wallet:account-creation-data',\n    )!;\n\n    return [\n      {\n        accountId,\n        publicKey: JSON.parse(currentAccount)?.devicePublicKey,\n      },\n    ];\n  };\n\n  const switchAccount = async (id: string): Promise<null> => {\n    //TODO fix\n    setActiveAccountId(id);\n\n    return null;\n  };\n\n  const setActiveAccountId = (accountId: string): null => {\n    activeAccountId = accountId;\n    window.localStorage.setItem('mintbase-wallet:activeAccountId', accountId);\n\n    return null;\n  };\n\n  // const transformTransactions = async (\n  //   transactions: Array<Optional<Transaction, 'signerId'>>,\n  // ): Promise<Array<nearAPI.transactions.Transaction>> => {\n  //   const account = state.wallet.account();\n  //   const { networkId, signer, provider } = account.connection;\n\n  //   const localKey = await signer.getPublicKey(account.accountId, networkId);\n\n  //   return Promise.all(\n  //     transactions.map(async (transaction, index) => {\n  //       const actions = transaction.actions.map((action) =>\n  //         createAction(action),\n  //       );\n  //       const accessKey = await account.accessKeyForTransaction(\n  //         transaction.receiverId,\n  //         actions as any,\n  //         localKey,\n  //       );\n\n  //       if (!accessKey) {\n  //         throw new Error(\n  //           `Failed to find matching key for transaction sent to ${transaction.receiverId}`,\n  //         );\n  //       }\n\n  //       const block = await provider.block({ finality: 'final' });\n\n  //       return nearAPI.transactions.createTransaction(\n  //         account.accountId,\n  //         nearAPI.utils.PublicKey.from(accessKey.public_key),\n  //         transaction.receiverId,\n  //         accessKey.access_key.nonce + index + 1,\n  //         actions as any,\n  //         nearAPI.utils.serialize.base_decode(block.header.hash),\n  //       );\n  //     }),\n  //   );\n  // };\n\n  return {\n    getAccountId,\n    isSignedIn,\n    signIn,\n    signOut,\n    signAndSendTransaction,\n    verifyOwner,\n    signMessage,\n    getAvailableBalance,\n    getAccounts,\n    switchAccount,\n    signAndSendTransactions,\n    verifyMessage,\n  };\n};\n","\nimport type {\n  BrowserWallet,\n  WalletModule,\n  WalletModuleFactory,\n} from '@near-wallet-selector/core';\nimport { BitteWallet } from './bitte-wallet';\nimport { resolveBitteWallet } from './utils';\n  \n  interface BitteWalletSetup {\n    callbackUrl?: string;\n    successUrl?: string;\n    walletUrl?: string;\n    failureUrl?: string;\n    deprecated?: boolean;\n    contractId?: string;\n    lak?: boolean;\n  }\n  \n  const icon = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTUiIGhlaWdodD0iOTUiIHZpZXdCb3g9IjAgMCA5NSA5NSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xLjc3NjE3IDU5LjE4MjZMNjIuNzIyNyA2My4zMTNDNjMuMTE4NSA2My40MzA5IDYzLjQ3ODggNjMuNjQ1NiA2My43NzA4IDYzLjkzNzdDNjQuMDYyOSA2NC4yMjk3IDY0LjI3NzUgNjQuNTg5OSA2NC4zOTU0IDY0Ljk4NThMNjguNTI1OSA3OC44NTU1QzY4LjY3ODcgNzkuMzY4NiA2OC45OTMyIDc5LjgxODYgNjkuNDIyNCA4MC4xMzg3QzY5Ljg1MTYgODAuNDU4NyA3MC4zNzI3IDgwLjYzMTYgNzAuOTA4MiA4MC42MzE2QzcxLjQ0MzYgODAuNjMxNiA3MS45NjQ3IDgwLjQ1ODcgNzIuMzkzOSA4MC4xMzg3QzcyLjgyMzEgNzkuODE4NiA3My4xMzc2IDc5LjM2ODYgNzMuMjkwNCA3OC44NTU1TDc3LjQyMDkgNjQuOTg1OEM3Ny41Mzg4IDY0LjU4OTkgNzcuNzUzNCA2NC4yMjk3IDc4LjA0NTUgNjMuOTM3N0M3OC4zMzc2IDYzLjY0NTYgNzguNjk3OCA2My40MzA5IDc5LjA5MzYgNjMuMzEzTDkyLjk2MzMgNTkuMTgyNkM5My40NzY0IDU5LjAyOTcgOTMuOTI2NSA1OC43MTUzIDk0LjI0NjYgNTguMjg2MUM5NC41NjY2IDU3Ljg1NjggOTQuNzM5NSA1Ny4zMzU3IDk0LjczOTUgNTYuODAwM0M5NC43Mzk1IDU2LjI2NDkgOTQuNTY2NiA1NS43NDM4IDk0LjI0NjYgNTUuMzE0NkM5My45MjY1IDU0Ljg4NTMgOTMuNDc2NCA1NC41NzA5IDkyLjk2MzMgNTQuNDE4MUw3OS4wOTM3IDUwLjI4NzZDNzguNjk3OCA1MC4xNjk3IDc4LjMzNzYgNDkuOTU1IDc4LjA0NTUgNDkuNjYzQzc3Ljc1MzUgNDkuMzcwOSA3Ny41Mzg4IDQ5LjAxMDcgNzcuNDIwOSA0OC42MTQ4TDczLjI5MDQgMzQuNzQ1MkM3My4xMzc2IDM0LjIzMiA3Mi44MjMyIDMzLjc4MTkgNzIuMzkzOSAzMy40NjE5QzcxLjk2NDcgMzMuMTQxOSA3MS40NDM2IDMyLjk2OSA3MC45MDgyIDMyLjk2OUM3MC4zNzI4IDMyLjk2OSA2OS44NTE3IDMzLjE0MTkgNjkuNDIyNCAzMy40NjE5QzY4Ljk5MzIgMzMuNzgxOSA2OC42Nzg4IDM0LjIzMiA2OC41MjYgMzQuNzQ1Mkw2NC4zOTU0IDQ4LjYxNDhDNjQuMjc3NiA0OS4wMTA3IDY0LjA2MjkgNDkuMzcwOSA2My43NzA4IDQ5LjY2M0M2My40Nzg4IDQ5Ljk1NSA2My4xMTg1IDUwLjE2OTcgNjIuNzIyNyA1MC4yODc2TDEuNzc2MTggNTQuNDE4MUMxLjI2MzA1IDU0LjU3MDkgMC44MTI5NTYgNTQuODg1MyAwLjQ5MjkyIDU1LjMxNDZDMC4xNzI4ODQgNTUuNzQzOCAyLjI0NzU1ZS0wNiA1Ni4yNjQ5IDAgNTYuODAwM0MtMi4yNDc1MWUtMDYgNTcuMzM1NyAwLjE3Mjg4NyA1Ny44NTY4IDAuNDkyOTIgNTguMjg2MUMwLjgxMjk1MyA1OC43MTUzIDEuMjYzMDMgNTkuMDI5NyAxLjc3NjE3IDU5LjE4MjZaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMyLjE2MzcgMjkuNDg2OEw0MC4zNTc4IDMxLjkyNzFDNDAuNTkxNyAzMS45OTY3IDQwLjgwNDUgMzIuMTIzNiA0MC45NzcgMzIuMjk2MUM0MS4xNDk2IDMyLjQ2ODcgNDEuMjc2NCAzMi42ODE1IDQxLjM0NjEgMzIuOTE1NEw0My43ODYzIDQxLjEwOTVDNDMuODc2NiA0MS40MTI2IDQ0LjA2MjQgNDEuNjc4NSA0NC4zMTYgNDEuODY3NkM0NC41Njk2IDQyLjA1NjcgNDQuODc3NCA0Mi4xNTg4IDQ1LjE5MzcgNDIuMTU4OEM0NS41MTAxIDQyLjE1ODggNDUuODE3OSA0Mi4wNTY3IDQ2LjA3MTUgNDEuODY3NkM0Ni4zMjUxIDQxLjY3ODUgNDYuNTEwOSA0MS40MTI2IDQ2LjYwMTEgNDEuMTA5NUw0OS4wNDE0IDMyLjkxNTRDNDkuMTExMSAzMi42ODE1IDQ5LjIzNzkgMzIuNDY4NyA0OS40MTA0IDMyLjI5NjFDNDkuNTgzIDMyLjEyMzYgNDkuNzk1OCAzMS45OTY3IDUwLjAyOTcgMzEuOTI3MUw1OC4yMjM4IDI5LjQ4NjhDNTguNTI2OSAyOS4zOTY2IDU4Ljc5MjggMjkuMjEwOCA1OC45ODE5IDI4Ljk1NzJDNTkuMTcxIDI4LjcwMzYgNTkuMjczMSAyOC4zOTU4IDU5LjI3MzEgMjguMDc5NEM1OS4yNzMxIDI3Ljc2MzEgNTkuMTcxIDI3LjQ1NTMgNTguOTgxOSAyNy4yMDE3QzU4Ljc5MjggMjYuOTQ4MSA1OC41MjY5IDI2Ljc2MjMgNTguMjIzOCAyNi42NzJMNTAuMDI5NiAyNC4yMzE3QzQ5Ljc5NTggMjQuMTYyMSA0OS41ODI5IDI0LjAzNTIgNDkuNDEwNCAyMy44NjI3QzQ5LjIzNzkgMjMuNjkwMiA0OS4xMTEgMjMuNDc3MyA0OS4wNDE0IDIzLjI0MzRMNDYuNjAxMSAxNS4wNDkzQzQ2LjUxMDggMTQuNzQ2MiA0Ni4zMjUgMTQuNDgwMyA0Ni4wNzE1IDE0LjI5MTJDNDUuODE3OSAxNC4xMDIxIDQ1LjUxIDE0IDQ1LjE5MzcgMTRDNDQuODc3NCAxNCA0NC41Njk1IDE0LjEwMjEgNDQuMzE1OSAxNC4yOTEyQzQ0LjA2MjMgMTQuNDgwMyA0My44NzY2IDE0Ljc0NjIgNDMuNzg2MyAxNS4wNDkzTDQxLjM0NiAyMy4yNDM0QzQxLjI3NjQgMjMuNDc3MyA0MS4xNDk1IDIzLjY5MDIgNDAuOTc3IDIzLjg2MjdDNDAuODA0NCAyNC4wMzUyIDQwLjU5MTYgMjQuMTYyMSA0MC4zNTc4IDI0LjIzMTdMMzIuMTYzNyAyNi42NzJDMzEuODYwNSAyNi43NjIyIDMxLjU5NDYgMjYuOTQ4IDMxLjQwNTUgMjcuMjAxNkMzMS4yMTY0IDI3LjQ1NTIgMzEuMTE0MyAyNy43NjMxIDMxLjExNDMgMjguMDc5NEMzMS4xMTQzIDI4LjM5NTggMzEuMjE2NCAyOC43MDM3IDMxLjQwNTUgMjguOTU3MkMzMS41OTQ2IDI5LjIxMDggMzEuODYwNSAyOS4zOTY2IDMyLjE2MzcgMjkuNDg2OFoiIGZpbGw9ImJsYWNrIi8+Cjwvc3ZnPgo=';\n  \n  export function setupBitteWallet({\n    walletUrl = '',\n    deprecated = false,\n    successUrl = '',\n    failureUrl = '',\n    callbackUrl = '',\n    contractId = '',\n  }: BitteWalletSetup = {}): WalletModuleFactory<BrowserWallet> {\n  \n    return async (moduleOptions): Promise<WalletModule<BrowserWallet> | null> => {\n  \n      const wallet: WalletModule<BrowserWallet> = {\n        id: 'bitte-wallet',\n        type: 'browser',\n        metadata: {\n          name: 'Bitte Wallet',\n          description:\n            'NEAR wallet to store, buy, send and stake assets for DeFi.',\n          iconUrl: icon,\n          deprecated,\n          available: true,\n          successUrl,\n          failureUrl,\n          walletUrl: resolveBitteWallet(moduleOptions.options.network.networkId, walletUrl),\n        },\n        init: (options) => {\n          return BitteWallet({ callback: callbackUrl, networkId: moduleOptions.options.network.networkId, successUrl, failureUrl, contractId,  ...options });\n        },\n      };\n      return wallet;\n    };\n  }\n  "]}